<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PulseCAD Login</title>
    <style>
        body {
            background: #181c24;
            color: #fff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .login-container {
            background: #232a36;
            padding: 2rem 2.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.3);
            width: 320px;
        }
        .login-container h2 {
            text-align: center;
            margin-bottom: 1.5rem;
            letter-spacing: 1px;
        }
        .login-container label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        .login-container input[type="text"],
        .login-container input[type="password"] {
            width: 100%;
            padding: 0.6rem;
            margin-bottom: 1.2rem;
            border: none;
            border-radius: 6px;
            background: #1a202b;
            color: #fff;
            font-size: 1rem;
        }
        .login-container button {
            width: 100%;
            padding: 0.7rem;
            background: #3e8ef7;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }
        .login-container button:hover {
            background: #2563eb;
        }
        .error-message {
            color: #ff6b6b;
            text-align: center;
            margin-bottom: 1rem;
            display: none;
        }
        #my-communities-box {
            margin-top: 2.5rem;
            width: 320px;
            background: #232a36;
            border-radius: 10px;
            padding: 1.2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            color: #fff;
        }
        #my-communities-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        #no-communities-msg {
            color: #94a3b8;
            font-size: 0.95rem;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <h2 id="login-title">PulseCAD Login</h2>
        <div class="error-message" id="error-message">Invalid username or password.</div>
        <form id="login-form">
            <label for="username">Username</label>
            <input type="text" id="username" name="username" required>
            <label for="password">Password</label>
            <input type="password" id="password" name="password" required>
            <button type="submit">Login</button>
        </form>
        <button id="show-create-btn" type="button" style="background:none;border:none;color:#3e8ef7;text-decoration:underline;cursor:pointer;margin:1.2rem 0 0.5rem 0;display:block;width:100%;font-size:1rem;">Create a new account</button>
        <form id="create-password-form" style="display:none;">
            <label for="new-username">Create Username</label>
            <input type="text" id="new-username" name="new-username" required>
            <label for="new-password">Create Password</label>
            <input type="password" id="new-password" name="new-password" required>
            <button type="submit">Create Account</button>
            <button id="back-to-login-btn" type="button" style="background:none;border:none;color:#3e8ef7;text-decoration:underline;cursor:pointer;margin-top:1rem;display:block;width:100%;font-size:1rem;">Back to Login</button>
        </form>
        <div class="error-message" id="create-error-message"></div>
        <div id="community-area" style="display:none;flex-direction:column;align-items:center;justify-content:center;height:100%;">
            <div style="display:flex;gap:1.5rem;margin-top:2rem;">
                <button id="join-community-btn" style="padding:0.7rem 1.5rem;background:#3e8ef7;color:#fff;border:none;border-radius:6px;font-size:1rem;font-weight:bold;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.08);">Join Community</button>
                <button id="create-community-btn" style="padding:0.7rem 1.5rem;background:#22d3ee;color:#181c24;border:none;border-radius:6px;font-size:1rem;font-weight:bold;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.08);">Create Community</button>
            </div>
            <div id="my-communities-box">
                <h3 style="margin-top:0;margin-bottom:1rem;font-size:1.1rem;">My Communities</h3>
                <ul id="my-communities-list" style="list-style:none;padding:0;margin:0;"></ul>
                <div id="no-communities-msg" style="color:#94a3b8;font-size:0.95rem;">No communities yet.</div>
            </div>
            <div id="community-modal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;z-index:1000;">
                <div style="background:#181c24;padding:2.5rem 2.5rem 2rem 2.5rem;border-radius:16px;min-width:340px;max-width:95vw;box-shadow:0 6px 32px rgba(0,0,0,0.45);color:#fff;position:relative;display:flex;flex-direction:column;align-items:center;">
                    <button id="close-modal-btn" style="position:absolute;top:1.2rem;right:1.2rem;background:none;border:none;color:#fff;font-size:1.7rem;cursor:pointer;">&times;</button>
                    <h2 id="modal-community-name" style="font-size:2rem;font-weight:700;margin-bottom:1.2rem;letter-spacing:1px;text-align:center;color:#3e8ef7;"></h2>
                    <div id="modal-community-details" style="background:#232a36;padding:1.2rem 1.5rem;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.12);font-size:1.1rem;text-align:center;min-width:220px;">Welcome to this community!</div>
                </div>
            </div>
        </div> <!-- end community-area -->
    </div> <!-- end login-container -->
    <script>
        // Store credentials in localStorage for demo purposes
        const form = document.getElementById('login-form');
        const errorMessage = document.getElementById('error-message');
        const createForm = document.getElementById('create-password-form');
        const createError = document.getElementById('create-error-message');
        const showCreateBtn = document.getElementById('show-create-btn');
        const backToLoginBtn = document.getElementById('back-to-login-btn');
        const loginTitle = document.getElementById('login-title');
        const communityArea = document.getElementById('community-area');
        const joinCommunityBtn = document.getElementById('join-community-btn');

        // Load stored credentials or set default
        function getStoredCredentials() {
            const creds = localStorage.getItem('pulsecad_creds');
            if (creds) return JSON.parse(creds);
            return { username: 'admin', password: 'pulsecad' };
        }

        function setStoredCredentials(username, password) {
            localStorage.setItem('pulsecad_creds', JSON.stringify({ username, password }));
        }

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const username = form.username.value;
            const password = form.password.value;
            const creds = getStoredCredentials();
            if (username === creds.username && password === creds.password) {
                errorMessage.style.display = 'none';
                // Hide login UI, show community area
                form.style.display = 'none';
                showCreateBtn.style.display = 'none';
                loginTitle.style.display = 'none';
                communityArea.style.display = 'flex';
                renderCommunities();
            } else {
                errorMessage.style.display = 'block';
            }
        });

        showCreateBtn.addEventListener('click', function() {
            form.style.display = 'none';
            errorMessage.style.display = 'none';
            showCreateBtn.style.display = 'none';
            createForm.style.display = 'block';
            createError.style.display = 'none';
            loginTitle.textContent = 'Create Account';
        });

        backToLoginBtn.addEventListener('click', function() {
            form.style.display = 'block';
            showCreateBtn.style.display = 'block';
            createForm.style.display = 'none';
            createError.style.display = 'none';
            loginTitle.textContent = 'PulseCAD Login';
        });

        createForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const newUsername = createForm['new-username'].value.trim();
            const newPassword = createForm['new-password'].value;
            if (newUsername.length < 3 || newPassword.length < 4) {
                createError.textContent = 'Username must be at least 3 characters and password at least 4.';
                createError.style.display = 'block';
                createError.style.color = '#ff6b6b';
                return;
            }
            setStoredCredentials(newUsername, newPassword);
            createError.textContent = 'Account created! You can now log in.';
            createError.style.color = '#4ade80';
            createError.style.display = 'block';
            createForm.reset();
        });

        joinCommunityBtn.addEventListener('click', function() {
            const creds = getStoredCredentials();
            const username = creds.username;
            let communities = JSON.parse(localStorage.getItem('pulsecad_communities_' + username) || '[]');
            // No limit on number of communities
            const communityName = prompt('Enter the name of the community to join:');
            if (communityName && !communities.includes(communityName)) {
                communities.push(communityName);
                localStorage.setItem('pulsecad_communities_' + username, JSON.stringify(communities));
                renderCommunities();
                alert('Joined community: ' + communityName);
            } else if (communityName) {
                alert('You have already joined this community.');
            }
        });

        const createCommunityBtn = document.getElementById('create-community-btn');
        createCommunityBtn.addEventListener('click', function() {
            const creds = getStoredCredentials();
            const username = creds.username;
            let communities = JSON.parse(localStorage.getItem('pulsecad_communities_' + username) || '[]');
            let created = JSON.parse(localStorage.getItem('pulsecad_created_' + username) || '[]');
            // No limit on number of communities
            const communityName = prompt('Enter a name for your new community:');
            if (communityName && !communities.includes(communityName)) {
                communities.push(communityName);
                created.push(communityName);
                localStorage.setItem('pulsecad_communities_' + username, JSON.stringify(communities));
                localStorage.setItem('pulsecad_created_' + username, JSON.stringify(created));
                renderCommunities();
                alert('Community created: ' + communityName);
            } else if (communityName) {
                alert('You already have a community with this name.');
            }
        });

        function renderCommunities() {
            const creds = getStoredCredentials();
            const username = creds.username;
            // Only show created communities in 'My Communities'
            const created = JSON.parse(localStorage.getItem('pulsecad_created_' + username) || '[]');
            const myList = document.getElementById('my-communities-list');
            const noMsg = document.getElementById('no-communities-msg');
            myList.innerHTML = '';
            if (created.length === 0) {
                noMsg.style.display = 'block';
            } else {
                noMsg.style.display = 'none';
                created.forEach(function(name) {
                    const li = document.createElement('li');
                    li.style.display = 'flex';
                    li.style.alignItems = 'center';
                    li.style.justifyContent = 'space-between';
                    li.style.padding = '0.3rem 0';
                    const span = document.createElement('span');
                    span.textContent = name;
                    const viewBtn = document.createElement('button');
                    viewBtn.textContent = 'View';
                    viewBtn.style.marginLeft = '1rem';
                    viewBtn.style.padding = '0.2rem 0.8rem';
                    viewBtn.style.background = '#3e8ef7';
                    viewBtn.style.color = '#fff';
                    viewBtn.style.border = 'none';
                    viewBtn.style.borderRadius = '4px';
                    viewBtn.style.fontSize = '0.95rem';
                    viewBtn.style.cursor = 'pointer';
                    viewBtn.onclick = function() {
                        window.location.href = 'community-dashboard.html?name=' + encodeURIComponent(name);
                    };
                    li.appendChild(span);
                    li.appendChild(viewBtn);
                    myList.appendChild(li);
                });
            }
        }

        function showCommunityModal(name) {
            var modal = document.getElementById('community-modal');
            document.getElementById('modal-community-name').textContent = name;
            document.getElementById('modal-community-details').textContent = 'Welcome to your community: ' + name;
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
        }

        document.body.addEventListener('click', function(e) {
            if (e.target && e.target.id === 'close-modal-btn') {
                document.getElementById('community-modal').style.display = 'none';
            }
        });
    </script>
</body>
</html>
